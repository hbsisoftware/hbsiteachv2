@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
 <link href="~/Content/globals.css" rel="stylesheet" />
 <link href="~/jquery-easyui-1.5.1/themes/default/easyui.css" rel="stylesheet" />
    <link href="~/jquery-easyui-1.5.1/themes/icon.css" rel="stylesheet" />
     <script src="~/Scripts/jquery-2.2.1.js"></script>
    <script src="~/jquery-easyui-1.5.1/jquery.easyui.min.js"></script>

   <script>
      

      
       Date.prototype.format = function (format) {
           var o = {
               "Y": this.getYear(),
               "M+": this.getMonth(), // month    
               "d+": this.getDate(), // day    
               "h+": this.getHours(), // hour    
               "m+": this.getMinutes(), // minute    
               //"s+": this.getSeconds(), // second    
               "q+": Math.floor((this.getMonth() + 3) / 3), // quarter    
               "S": this.getMilliseconds()
               // millisecond    
           }
           if (/(y+)/.test(format))
               format = format.replace(RegExp.$1, (this.getFullYear() + "")
                   .substr(4 - RegExp.$1.length));
           for (var k in o)
               if (new RegExp("(" + k + ")").test(format))
                   format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
           return format;
       }
       function formatDatebox(value) {
           if (value == null || value == '') {
               return '';
           }
           var dt;
           if (value instanceof Date) {
               dt = value;
           } else {
               dt = new Date(value);
           }

           return dt.format("yyyy-MM-dd"); //扩展的Date的format方法(上述插件实现)    
       }



       $(function () {
           $('#tb').datagrid({
               url: '/PartJobTeacherDocs/GetDocs',
               width: 400,
               height: 400,
              
               fitColumns: true,
               singleSelect: true,
               toolbar: [{
                   text: '添加',
                   iconCls: 'icon-add',
                   handler: function () {
                       $("#PJTD_add_dig").dialog({
                           title: "兼职教师添加---",
                           iconCls: 'icon-add',
                           closed: false,
                           modal: true,
                           href: '/PartJobTeacherDocs/Add',
                           width: 400,
                           height: 300,
                           buttons: [
                               {
                                   text: '保存',
                                   iconCls: 'icon-save',
                                   handler: function () {

                                       var PJTeacherID = $("#PJTD_add_PJTeacherID").val();
                                       var url = $("#fileupload").filebox("getValue");
                                       var doc = $("#PJTD_add_Doc").val();
                                       var time = $("#PJTD_add_Time").val();
                                       $.get("/PartJobTeacherDocs/AddDocs", { PJTeacherID: PJTeacherID, Url: url, DocTypeID: doc, UploadTime: time, Status: 0 }, function (data) {
                                           if (data == "ok") {
                                               $.messager.show({
                                                   title: '提示...',
                                                   msg: '保存成功',
                                                   showType: 'show'
                                               })
                                               $("#PJTD_add_dig").dialog("close");
                                               $("#tb").datagrid("reload");

                                           }

                                           else {
                                               alert("出错");
                                           }


                                       }, "text")
                                   }


                               }, {
                                   text: '取消',
                                   iconCls: 'icon-cancel',
                                   handler: function () {
                                       $("#PJTD_add_dig").dialog("close");

                                   }

                               }
                           ]

                       });
                   }
               },

               {
                   text: '修改',
                   iconCls: 'icon-edit',
                   handler: function () {
                       var id = $("#tb").datagrid("getSelected").id;
                       var url = "/PartJobTeacherDocs/Edit?id=" + id;
                       $("#PJTD_edit_dig").dialog({
                           title: "兼职教师修改---",
                           iconCls: 'icon-edit',

                           modal: true,
                           width: 400,
                           height: 10,
                           href: url,
                           buttons: [
                               {
                                   text: '修改',
                                   iconCls: 'icon-edit',
                                   handler: function () {
                                       var id = $("#type_add_id").val();
                                       var name = $("#type_add_name").val();
                                       var typeid = $("#type_edit_typeid").val();

                                       $.get("/PartJobTeacherDocs/load", { id: id, name: name, typid: typeid, Status: 0 }, function (data) {

                                           if (data == "ok") {
                                               $.messager.show({
                                                   title: '提示...',
                                                   msg: '修改成功',
                                                   showType: 'show'
                                               })

                                               $("#tb").datagrid("reload");
                                               $("#PJTD_edit_dig").dialog("close");
                                           }
                                           else { alert("失败"); }

                                       }, "text")

                                   }


                               }, {
                                   text: '取消',
                                   iconCls: 'icon-cancel',
                                   handler: function () {
                                       $("#PJTD_edit_dig").dialog("close");

                                   }

                               }
                           ]

                       });

                   }

               }, '-', {
                   text: '删除',
                   iconCls: 'icon-remove',
                   handler: function () {
                       //var id = $("#tb").datagrid("getSelected").ID;
                       //del(id);
                       var row = $("#tb").datagrid("getSelected")
                       if (row != null) {
                           var name = row.name;
                           $.messager.confirm("提示...", "确定要删除“" + name + "”吗？", function (retult) {
                               if (retult) {
                                   var id = row.ID;
                                   $.get("/PartJobTeacherDocs/DeleteDocs/", { id: id }, function (data) {
                                       if (data == "ok") {
                                           $("#tb").datagrid("reload");

                                           $.messager.show({
                                               title: '提示...',
                                               msg: '删除成功',
                                               showType: 'show'

                                           })
                                       }

                                       else
                                           $.messager.show({
                                               title: '提示...',
                                               msg: '删除失败',
                                               showType: 'show'

                                           })


                                   }, "text")
                               }
                           })

                       }
                   }
               }],

               columns: [[

                   { field: 'PName', title: '兼职教师', width: 100 },
                     { field: 'Url', title: '文档路径', width: 150 },
                      { field: 'DocTypeId', title: '文档类型', width: 150 },
                     {
                         field: 'UploadTime', title: '上传日期', width: 100, formatter: formatDatebox, editor: 'datebox'
                     }
               ]]

           })
       })

    </script>
</head>
<body>
    <table id="tb"></table>
    <div id="PJTD_add_dig">  </div>
    <div id="PJTD_edit_dig"></div>
</body>
</html>

