@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/Content/globals.css" rel="stylesheet" />
    <link href="~/Content/selectcss.css" rel="stylesheet" />
    <link href="~/jquery-easyui-1.5.1/themes/default/easyui.css" rel="stylesheet" />
    
    <link href="~/jquery-easyui-1.5.1/themes/icon.css" rel="stylesheet" />

    
    <script src="~/jquery-easyui-1.5.1/jquery.min.js"></script>
    <script src="~/jquery-easyui-1.5.1/jquery.easyui.min.js"></script>
    <script src="~/jquery-easyui-1.5.1/locale/easyui-lang-zh_CN.js"></script>
    <script src="~/exportExcel/Excel.js"></script>
   
    <title>Index</title>
    <script>
        $(function () {
            var url = "";
            var tb = [{
                text: '添加',
                iconCls: 'icon-add',
                handler: function () {
                    
                    url = "/BookUsed/add";
                    $("#BookUsed-dlg").dialog({
                        title: '教材选用添加',
                        iconCls: 'icon-add',
                        width: 550,
                        height: 250,
                        href: url,
                        modal: true,
                        buttons: [{
                            text: '确定',
                            iconCls: 'icon-ok',
                            handler: function () {
                                $("#BookUsed-add-form").form({
                                    url: '/BookUsed/BookUseAdd/',
                                    success: function (data) {
                                        if (data == "ok") {
                                            $.messager.show({
                                                title: '提示...',
                                                msg: '添加成功！',
                                                showType: 'show'
                                            });
                                            $("#tb").datagrid("reload");
                                            $("#BookUsed-dlg").dialog("close");
                                        }
                                        else {
                                            $.messager.show({
                                                title: '提示...',
                                                msg: '添加失败！！',
                                                showType: 'show'
                                            });
                                        }
                                    }
                                })
                                $("#BookUsed-add-form").submit();
                            }
                        }, {
                            text: '取消',
                            iconCls: 'icon-no',
                            handler: function () {
                                $("#BookUsed-dlg").dialog("close");
                            }
                        }]

                    })
                }
            }, {
                text: '修改',
                iconCls: 'icon-edit',
                handler: function () {
                    var row = $("#tb").datagrid("getSelected");
                    if (row == null) {
                        $.messager.alert("提示...", "请选中行！！", "warning");
                        return;
                    }
                    var id = row.ID;
                    url = "/BookUsed/edit/" + id;
                    $("#BookUsed-dlg").dialog({
                        title: '教材选用修改',
                        iconCls: 'icon-add',
                        width: 550,
                        height: 250,
                        href: url,
                        modal: true,
                        buttons: [{
                            text: '确定',
                            iconCls: 'icon-ok',
                            handler: function () {
                                $("#BookUsed-add-form").form({
                                    url: '/BookUsed/EditBooksUse/',
                                    success: function (data) {
                                        if (data == "ok") {
                                            $.messager.show({
                                                title: '提示...',
                                                msg: '修改成功！！',
                                                showType: 'show'
                                            });
                                            $("#tb").datagrid("reload");
                                            $("#BookUsed-dlg").dialog("close");
                                        }
                                        else {
                                            $.messager.show({
                                                title: '提示...',
                                                msg: '修改失败！！',
                                                showType: 'show'
                                            })
                                        }
                                    }
                                });
                                $("#BookUsed-add-form").submit();
                            }
                        }, {
                            text: '取消',
                            iconCls: 'icon-no',
                            handler: function () {
                                $("#BookUsed-dlg").dialog("close");
                            }
                        }]

                    })
                }
            }, '-', {
                text: '删除',
                iconCls: 'icon-remove',
                handler: function () {
                    var row = $("#tb").datagrid("getSelected");
                    if (row == null) {
                        $.messager.alert("提示...", "请选中行!!", "wraning");
                        return;
                    }
                    var id = row.ID;
                    var name = row.CoursesName;
                    $.messager.confirm("提示...", "你确定要删除" + name + "这条记录？", function (r) {
                        if (r) {
                            $.get("/BookUsed/RemteBookUse", { id: id }, function (data) {
                                if (data == "ok") {
                                    $.messager.show({
                                        title: '提示...',
                                        msg: '删除成功！',
                                        showType: 'show'
                                    })
                                    $("#tb").datagrid("reload");
                                }
                                else {
                                    $.messager.show({
                                        title: '提示...',
                                        msg: '删除失败！！',
                                        showType: 'show'
                                    })
                                }
                            }, "text")
                        }
                    })
                }
            }]
            $("#tb").datagrid({
                url: '/BookUsed/getBookUsed',
                singleSelect: true,
                width: 600,
                pagination: true,
                fitColums: true,
                toolbar: tb,
                columns: [[
                           { field: 'CoursesName', title: '课程名称', width: 150 },
                           { field: 'TeacherName', title: '教师名称', width: 100 },
                           { field: 'Name', title: '教材名称', width: 150 ,formatter:a},
                           { field: 'StuBookNums', title: '学生用书数量', width: 80 },
                           { field: 'TeaBookNums', title: '教师用书数量', width: 80 }
                         ]]
            })
        });
        function a(value, row, index) {
            return "<a href='javascript:;' target='_blank' onclick='ByValue(&apos;" + value + "&apos;)'>" + value + "</a>";
        };
        function ByValue(name) {
            $("#dialog").dialog({
                title: '教材详细信息',
                iconCls: 'icon-add',
                width: 575,
                fitColums: true,
                modal: true,
                onOpen: function () {
                    $("#BookInformation").datagrid({
                        url: '/BookUsed/getBooksContent?name=' + name,
                        singleSelect: true,
                        width: 800,
                        fitColums: true,
                        columns: [[
                                   { field: 'Name', title: '名称', width: 150 },
                                   { field: 'pubName', title: '出版社', width: 100 },
                                   { field: 'PubYear', title: '出版年份', width: 80 },
                                   { field: 'Price', title: '价格', width: 80 },
                                   { field: 'BPN', title: '教材性质', width: 80 },
                                   { field: 'BTN', title: '教材类别', width: 80 }
                        ]]
                    })
                },
                buttons: [{
                    text: '关闭',
                    iconCls: 'icon-ok',
                    handler: function () {
                        $("#dialog").dialog("close");
                    }
                }]
            })
        }
        function query() {
            $("#tb").datagrid("load", {
                e: $("#term").val()
            });
            $.get("/BookUsed/getBookUseds", { e: $("#term").val() }, function (data) {
                $(data).each(function (index, da) {
                    $("#Excel-body").append("<tr><td>" + da.CoursesName + "</td><td>" + da.TeacherName + "</td><td>" + da.Name + "</td><td>" + da.StuBookNums + "</td><td>" + da.TeaBookNums + "</td></tr>")
                })
            }, "json");
        }
    </script>
    <style scoped="scoped">
        .textbox {
            height: 20px;
            margin: 0;
            padding: 0 2px;
            box-sizing: content-box;
        }
    </style>
</head>
<body>
    <div>
        <label>学期:</label>@*<select id="term" class="select" ></select>*@
        <a id="s" href="javascript:void(0)" class="sel_mask">
            <span id="sl" style="color:black;font-size:10px;">请选择</span>
            <img src="~/jquery-easyui-1.5.1/themes/default/images/combo_arrow.png" />
            <select id="term" class="sel" onchange="s()"></select>
        </a>
        <a id="search" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="query()">查询</a>
        <a id="export" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="getImport('Excel')">导出</a>
        <table id="tb"></table>
        <table id="Excel" border="1">
            <thead>
                <tr><th>课程名称</th><th>教师名称</th><th>教材名称</th><th>学生用书数量</th><th>教师用书数量</th></tr>
            </thead>
            <tbody id="Excel-body">
            </tbody>
        </table>
        <div id="dialog">
            <table id="BookInformation"></table>
        </div>
    </div>
    <div id="BookUsed-dlg"></div>
    <script>
        function s() {
            var text = $("#term").val()
            $("#sl").text(text)
        }
        $(function () {
            $("#Excel").hide();
            
            $.get("/bookused/Term", function (data) {
                $(data).each(function (index, da) {
                    $("#term").append("<option>" + da.termName + "</option>")
                })
            }, "json");
            
        });
    </script>
</body>
</html>

